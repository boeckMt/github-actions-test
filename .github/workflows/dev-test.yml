# This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: Dev Test

on:
  push:
    branches-ignore:
      # run on all branches other then main
      - main
    tags-ignore:
      # And do not run for any tags
      - '*'
    paths-ignore:
      - '**.md'

jobs:
  checkTags:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v2
      with:
        node-version: 14
      id: check-tag
    - run: |
        git fetch --prune --all --unshallow --tags
        $ latestTag = git describe --tags `git rev-list --tags --max-count=1`
        $ packageVersion = node -p "require('./package.json').version"
        if [[contains($latestTag, $packageVersion)]]; then
              echo ::set-output name=tagexists::true
        fi

  event:
    if: checkTags.steps.check-tag.outputs.tagexists == 'true'
    runs-on: ubuntu-latest
    steps:
    - run: |
          echo "${{ github.event_name }}"
          echo "${{ github.ref }}"
